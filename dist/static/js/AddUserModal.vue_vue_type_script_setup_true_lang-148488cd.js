import{u as e}from"./useDept-db27839c.js";import{e as l,d as a,z as d,r as t,f as s,o,q as u,w as i,h as m,i as n,k as r,j as c,eO as p,M as f}from"./index-7745a379.js";import{j as h,k as V,l as x}from"./index-4e03c955.js";import{E as b,a as g}from"./regexp-53006fbc.js";const _=a({__name:"AddUserModal",setup(a,{expose:_}){const{roleList:v,getRoleList:w}=function(){const e=l(!1),a=l([]),d=l(0);return{roleList:a,getRoleList:async()=>{try{e.value=!0;const l=await h();a.value=l.data.list.filter((e=>1===e.status)),d.value=l.data.total}catch(l){}finally{e.value=!1}},loading:e,total:d}}();w();const k=d((()=>v.value.map((e=>({label:e.name,value:e.code}))))),I=l(),U=l(""),y=d((()=>!!U.value)),j=d((()=>y.value?"编辑用户":"新增用户")),q=l(!1),L=t({id:"",username:"",nickname:"",gender:1,phone:"",email:"",deptId:"",roleIds:[],description:"",status:1,type:2,disabled:!1}),R={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:b,message:"邮箱格式不正确"}],phone:[{match:g,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],roleIds:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]},{deptList:z,getDeptList:O}=e();O();const D=()=>{var e;null==(e=I.value)||e.resetFields()};_({add:()=>{U.value="",q.value=!0},edit:async e=>{q.value=!0,U.value=e;const l=await V({id:e});Object.assign(L,l.data)}});const F=async()=>{try{return!!(await x(L)).data&&(f.success("模拟保存成功"),!0)}catch(e){return!1}};return(e,l)=>{const a=s("a-input"),d=s("a-form-item"),t=s("a-col"),f=s("a-row"),h=s("a-radio"),V=s("a-radio-group"),x=s("a-tree-select"),b=s("a-select"),g=s("a-textarea"),_=s("a-switch"),v=s("a-form"),w=s("a-modal");return o(),u(w,{visible:n(q),"onUpdate:visible":l[9]||(l[9]=e=>c(q)?q.value=e:null),width:n(p)()?"100%":600,title:n(j),"mask-closable":!1,onBeforeOk:F,onClose:D},{default:i((()=>[m(v,{ref_key:"FormRef",ref:I,model:n(L),rules:R,size:"medium","auto-label-width":""},{default:i((()=>[m(f,null,{default:i((()=>[m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"用户名",field:"username"},{default:i((()=>[m(a,{modelValue:n(L).username,"onUpdate:modelValue":l[0]||(l[0]=e=>n(L).username=e),placeholder:"请输入用户名",disabled:n(L).disabled},null,8,["modelValue","disabled"])])),_:1})])),_:1}),m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"昵称",field:"nickname"},{default:i((()=>[m(a,{modelValue:n(L).nickname,"onUpdate:modelValue":l[1]||(l[1]=e=>n(L).nickname=e),placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(f,null,{default:i((()=>[m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"手机号码",field:"phone"},{default:i((()=>[m(a,{modelValue:n(L).phone,"onUpdate:modelValue":l[2]||(l[2]=e=>n(L).phone=e),placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1})])),_:1}),m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"邮箱",field:"email"},{default:i((()=>[m(a,{modelValue:n(L).email,"onUpdate:modelValue":l[3]||(l[3]=e=>n(L).email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(d,{label:"性别",field:"gender"},{default:i((()=>[m(V,{modelValue:n(L).gender,"onUpdate:modelValue":l[4]||(l[4]=e=>n(L).gender=e)},{default:i((()=>[m(h,{value:1},{default:i((()=>[r("男")])),_:1}),m(h,{value:2},{default:i((()=>[r("女")])),_:1})])),_:1},8,["modelValue"])])),_:1}),m(d,{label:"所属部门",field:"deptId"},{default:i((()=>[m(x,{modelValue:n(L).deptId,"onUpdate:modelValue":l[5]||(l[5]=e=>n(L).deptId=e),data:n(z),fieldNames:{key:"id",title:"name"},placeholder:"请选择所属部门","allow-clear":"","allow-search":"",disabled:n(L).disabled},null,8,["modelValue","data","disabled"])])),_:1}),m(d,{label:"角色",field:"roleIds",disabled:n(L).disabled},{default:i((()=>[m(b,{modelValue:n(L).roleIds,"onUpdate:modelValue":l[6]||(l[6]=e=>n(L).roleIds=e),options:n(k),placeholder:"请选择所属角色",multiple:"","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])])),_:1},8,["disabled"]),m(d,{label:"描述",field:"description"},{default:i((()=>[m(g,{modelValue:n(L).description,"onUpdate:modelValue":l[7]||(l[7]=e=>n(L).description=e),"max-length":200,placeholder:"请填写描述","auto-size":{minRows:3},"show-word-limit":""},null,8,["modelValue"])])),_:1}),m(d,{label:"状态",field:"status"},{default:i((()=>[m(_,{type:"round",modelValue:n(L).status,"onUpdate:modelValue":l[8]||(l[8]=e=>n(L).status=e),"checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","width","title"])}}});export{_};

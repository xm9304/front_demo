import{E as e,a as l}from"./regexp-2217f7b7.js";import{r as a,d,B as t,f as s,o,t as u,w as i,g as m,i as r,l as n,k as c,M as p}from"./index-f2e976d2.js";import{g as f,s as g}from"./user-24708e4b.js";import{u as h}from"./useDept-dd363734.js";import{b as x}from"./role-839a3869.js";import{u as v}from"./useForm-824f41a7.js";const V=d({__name:"AddUserModal",emits:["save-success"],setup(d,{expose:V,emit:b}){const _=b,{roleList:w,getRoleList:k}=function(){const e=a(!1),l=a([]),d=a(0);return{roleList:l,getRoleList:async()=>{try{e.value=!0;const a=await x({current:1,pageSize:99});l.value=a.data.records.filter((e=>1===e.status)),d.value=a.data.total}finally{e.value=!1}},loading:e,total:d}}();k();const y=t((()=>w.value.map((e=>({label:e.name,value:e.code}))))),{deptList:I,getDeptList:U}=h();U();const j=a(),M=a(""),L=t((()=>!!M.value)),q=t((()=>L.value?"编辑用户":"新增用户")),F=a(!1),{form:R,resetForm:z}=v({id:"",username:"",nickname:"",gender:1,phone:"",email:"",deptId:"",roleIds:[],description:"",status:1,type:2,disabled:!1}),B={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:e,message:"邮箱格式不正确"}],phone:[{match:l,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],roleIds:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]},D=()=>{var e;null==(e=j.value)||e.resetFields(),z()};V({add:()=>{M.value="",F.value=!0},edit:async e=>{F.value=!0,M.value=e;const l=await f({id:e});Object.assign(R,l.data)}});const E=async()=>{var e;try{if(await(null==(e=j.value)?void 0:e.validate()))return!1;return!!(await g(R)).data&&(p.success("模拟保存成功"),_("save-success"),!0)}catch(l){return!1}};return(e,l)=>{const a=s("a-input"),d=s("a-form-item"),t=s("a-col"),p=s("a-row"),f=s("a-radio"),g=s("a-radio-group"),h=s("a-tree-select"),x=s("a-select"),v=s("a-textarea"),V=s("a-switch"),b=s("a-form"),_=s("a-modal");return o(),u(_,{visible:r(F),"onUpdate:visible":l[9]||(l[9]=e=>c(F)?F.value=e:null),title:r(q),width:"90%","mask-closable":!1,"modal-style":{maxWidth:"600px"},onBeforeOk:E,onClose:D},{default:i((()=>[m(b,{ref_key:"FormRef",ref:j,model:r(R),rules:B,size:"medium","auto-label-width":""},{default:i((()=>[m(p,null,{default:i((()=>[m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"用户名",field:"username"},{default:i((()=>[m(a,{modelValue:r(R).username,"onUpdate:modelValue":l[0]||(l[0]=e=>r(R).username=e),modelModifiers:{trim:!0},placeholder:"请输入用户名","allow-clear":"",disabled:r(R).disabled,"max-length":10},null,8,["modelValue","disabled"])])),_:1})])),_:1}),m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"昵称",field:"nickname"},{default:i((()=>[m(a,{modelValue:r(R).nickname,"onUpdate:modelValue":l[1]||(l[1]=e=>r(R).nickname=e),modelModifiers:{trim:!0},placeholder:"请输入昵称","allow-clear":"","max-length":10},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(p,null,{default:i((()=>[m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"手机号码",field:"phone"},{default:i((()=>[m(a,{modelValue:r(R).phone,"onUpdate:modelValue":l[2]||(l[2]=e=>r(R).phone=e),modelModifiers:{trim:!0},placeholder:"请输入手机号码","allow-clear":"","max-length":11},null,8,["modelValue"])])),_:1})])),_:1}),m(t,{xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},{default:i((()=>[m(d,{label:"邮箱",field:"email"},{default:i((()=>[m(a,{modelValue:r(R).email,"onUpdate:modelValue":l[3]||(l[3]=e=>r(R).email=e),modelModifiers:{trim:!0},placeholder:"请输入邮箱","allow-clear":"","max-length":30},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(d,{label:"性别",field:"gender"},{default:i((()=>[m(g,{modelValue:r(R).gender,"onUpdate:modelValue":l[4]||(l[4]=e=>r(R).gender=e)},{default:i((()=>[m(f,{value:1},{default:i((()=>[n("男")])),_:1}),m(f,{value:2},{default:i((()=>[n("女")])),_:1})])),_:1},8,["modelValue"])])),_:1}),m(d,{label:"所属部门",field:"deptId"},{default:i((()=>[m(h,{modelValue:r(R).deptId,"onUpdate:modelValue":l[5]||(l[5]=e=>r(R).deptId=e),data:r(I),fieldNames:{key:"id",title:"name"},placeholder:"请选择所属部门","allow-clear":"","allow-search":"",disabled:r(R).disabled},null,8,["modelValue","data","disabled"])])),_:1}),m(d,{label:"角色",field:"roleIds",disabled:r(R).disabled},{default:i((()=>[m(x,{modelValue:r(R).roleIds,"onUpdate:modelValue":l[6]||(l[6]=e=>r(R).roleIds=e),options:r(y),placeholder:"请选择所属角色",multiple:"","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])])),_:1},8,["disabled"]),m(d,{label:"描述",field:"description"},{default:i((()=>[m(v,{modelValue:r(R).description,"onUpdate:modelValue":l[7]||(l[7]=e=>r(R).description=e),modelModifiers:{trim:!0},"max-length":200,placeholder:"请填写描述","auto-size":{minRows:3},"show-word-limit":""},null,8,["modelValue"])])),_:1}),m(d,{label:"状态",field:"status"},{default:i((()=>[m(V,{type:"round",modelValue:r(R).status,"onUpdate:modelValue":l[8]||(l[8]=e=>r(R).status=e),"checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])}}});export{V as _};
